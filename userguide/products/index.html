<!DOCTYPE html>
<html>
<head>
<title>Products Documentation</title>
<link rel="stylesheet" href="../userguide.css" />
</head>

<body>

<h1>Products Documentation</h1>
<p><a href="../../index.html#documentation">&laquo; Back to User Guide</a></p>


<h2>Known Product Types</h2>
<p>This is a list of known products being sent via Product
Distribution.</p>


<ul>
	<li><a href="dyfi.html">dyfi</a> (Did You Feel It?)</li>	
	<li><a href="focal-mechanism.html">focal-mechanism</a></li>
	<li><a href="link.html">general-link</a></li>
	<li><a href="text.html">general-text</a></li>	
	<li><a href="geoserve.html">geoserve</a></li>
	<li><a href="heartbeat.html">heartbeat</a></li>
	<li><a href="link.html">impact-link</a></li>
	<li><a href="text.html">impact-text</a></li>	
	<li><a href="losspager.html">losspager</a></li>
	<li><a href="moment-tensor.html">moment-tensor</a></li>
	<li><a href="nearby-cities.html">nearby-cities</a></li>
	<li><a href="origin.html">origin</a></li>
	<li><a href="origin.html">phase-data</a></li>
	<li><a href="link.html">scitech-link</a></li>
	<li><a href="shakemap.html">shakemap</a></li>	
	<li><a href="significance.html">significance</a></li>
	<li><a href="text.html">scitech-text</a></li>	
	<li><a href="tectonic-summary.html">tectonic-summary</a></li>
</ul>


<h2>Special "admin" products</h2>
<p>Most products provide information about one event. The existence
of one of these products in an event will change the way the indexer
indexes, and they are generated by administrative users who need to
override the default association/processing logic.</p>
<ul>
	<li><a href="associate.html">associate</a></li>
	<li><a href="disassociate.html">disassociate</a></li>
	<li><a href="trump.html">trump</a></li>
	<li><a href="trump.html">trump-<em>TYPE</em></a></li>
</ul>


<h2>Designing New Products</h2>
<h3>What is a Product?</h3>

<p>A product is a specific version of any content produced in
response to an earthquake, information about an earthquake, or another
product.</p>

<p>A product usually consists of a directory of files, but may also
include a stream of bytes, links to internet resources, and key/value
pairs.</p>


<h4>Product IDs</h4>
<p>The source, type, and code uniquely identify a product and its
associated content. Update times indicate different versions of the same
product, and products with more recent update times supersede products
with less recent update times.</p>

<dl>
	<dt>source</dt>
	<dd>The product creator. Usually a network code.</dd>

	<dt>type</dt>
	<dd>The type of product. Multiple sources may create the same type
	of product.</dd>

	<dt>code</dt>
	<dd>A unique code, for a given <code>source</code> and <code>type</code>
	combination.</dd>

	<dt>update time</dt>
	<dd>When this version of content was created. Two products with
	the same <code>source</code>, <code>type</code>, and <code>code</code>,
	but different <code>update time</code>s are different versions of the
	same product.</dd>
</dl>


<h4>Status</h4>
<p>A brief status code. Typically <code>UPDATE</code> or <code>DELETE</code>.
Any value that is not <code>DELETE</code> is considered an update.</p>

<p>When a product producer deletes a product they send an update
with a status <code>DELETE</code>, which is distributed like any other
product.</p>


<h4>Contents</h4>

<strong>Files</strong>
<p>Contents are optional, but are usually present when the status is
not <code>DELETE</code>. Each content has a path, which corresponds to a
filename.</p>

<strong>Non file content</strong>
<p>Each product may have one piece of content that is a stream of
bytes. It has an empty path and isn't stored in a file. Typically this
content is read from standard input, and also delivered to consumers via
standard input.</p>


<h4>Metadata</h4>

<strong>Links</strong>
<p>A product may include links to other products and resources.
Links have a relation, which specifies how the resource is related to the
product. There may be multiple links for each type of relation.</p>

<strong>Properties</strong>
<p>Key value pairs. Each property may only have one value. These can
be used to determine whether further processing is required. "Standard"
properties include:</p>

<dl>
	<dt>eventsource</dt>
	<dd>network code of related event</dd>

	<dt>eventsourcecode</dt>
	<dd>network event code of related event</dd>

	<dt>eventtime</dt>
	<dd>time of related event</dd>

	<dt>latitude</dt>
	<dd>latitude of related event</dd>

	<dt>longitude</dt>
	<dd>longitude of related event</dd>

	<dt>depth</dt>
	<dd>depth of related event</dd>

	<dt>magnitude</dt>
	<dd>magnitude of related event</dd>

	<dt>version</dt>
	<dd>producer product version. This is not used for ordering
	products, which use update time as a versions.</dd>
</dl>

<p>All of these properties are optional, but a combination of either
<code>eventsource</code> and <code>eventsourcecode</code> OR <code>eventtime</code>,
<code>latitude</code>, and <code>longitude</code> are recommended for
event-related products for association purposes.</p>


<h4>Signature</h4>
<p>Producers generate a signature which may be verified by both hubs
and consumers. The signature consists of a hash of all product contents
and attributes, which is encrypted using a private key and verified
using a public key.</p>

<p>Production hubs require a signature, and a keypair must be
registered before products are sent.</p>


<h3 id="content">Generating a &ldquo;Good&rdquo; Product</h3>
<p>The information contained in this section is a recommendation,
not a requirement however recommendations can be seen as a best practice
when generating new products.</p>

<h4 id="content_props">Product Properties</h4>
<p>Properties should be defined for important attributes of your
product. They allow recipients to quickly determine whether they should
process a product, without extensive parsing.</p>

<p>For example, <code>eventsource</code> and <code>eventsourcecode</code>
are used by the indexer to associate a product with an event. Other
examples include <code>dyfi</code> number of responses, <code>losspager</code>
alert level, and <code>shakemap</code> maximum MMI.</p>

<h4>Product-Specific Properties</h4>
<p>Products may have properties that are specific to that product type. For 
example, the <i>origin</i> product has a custom <i>azimuthal-gap</i> property. 
Like all product properties, these properties are set using name/value pairs, 
using either command line Java parameters on a product send, or within a node 
of an XML file sent with the product.</p>
<p>These properties aren't pre-configured using INI files like <i>config.ini</i>, 
however they often need programmatic support, such as identifying which XML file 
and node contains a custom property. For this reason, please contact 
<a href="mailto:jmfee@usgs.gov">jmfee@usgs.gov</a> in advance before creating a 
new product type.</p>


<h4 id="content_xml">Contents.xml File</h4>
<p>It is recommended you include with your product a
&ldquo;contents.xml&rdquo; file. This file describes all of the contents
you are sending with your product. It helps the web page to better
display your product and ultimately determines what content users will
be able to easily download from the web site.</p>
<p>The contents.xml file format is defined with a <a
	href="../contents.xsd">contents.xsd</a> file. You must understand how to
read <a href="http://www.w3schools.com/schema/" target="_blank">XML
schema (XSD)</a> files in order to properly generate a contents.xml file.</p>


<h4>Grouping Content</h4>
<p>When mapping products into PDL, it is important to consider how
content is generated and updated when deciding what individual products
should contain.
<p>For event-related products, the group of content is everything
related to that event.</p>

<p>For non-event-related products, the group depends more on how
content is generated and updated. For example, station related content
might be broken up by station. It's possible that this content would
need to be further divided based on update intervals.</p>

<h4>Product Code Conventions</h4>
<p>A product <code>code</code> must be unique forever, from the same
<code>source</code> and <code>type</code>. Product creators also reuse
the <code>code</code> to update or delete the product.</p>

<p>For event-related products, an eventid makes a good code because
it also must be unique forever. Examples include : <code>us2011abcd</code>
and <code>nc12345678</code>.</p>

<p>For non-event-related products another ID scheme is required.
Timestamps are often useful in this situation when the products are
related to a time window.</p>

<p>An internal database key <em>can</em> be used.

</body>
</html>
