<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ProductSummary.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">pdl</a> &gt; <a href="index.source.html" class="el_package">gov.usgs.earthquake.indexer</a> &gt; <span class="el_source">ProductSummary.java</span></div><h1>ProductSummary.java</h1><pre class="source lang-java linenums">/*
 * ProductSummary
 */
package gov.usgs.earthquake.indexer;

import gov.usgs.earthquake.product.Product;
import gov.usgs.earthquake.product.ProductId;
import gov.usgs.util.XmlUtils;

import java.util.Date;
import java.util.HashMap;
import java.util.Iterator;
import java.util.LinkedList;
import java.util.Map;
import java.math.BigDecimal;
import java.net.URL;
import java.util.List;
import java.net.URI;

/**
 * A product summary is essentially a product without its contents.
 */
public class ProductSummary {

	/** An ID used by the ProductIndex. */
<span class="fc" id="L26">	private Long indexId = null;</span>

	/** The product id. */
<span class="fc" id="L29">	private ProductId id = null;</span>

	/** The product status. */
<span class="fc" id="L32">	private String status = null;</span>

	/** The product tracker url. */
<span class="fc" id="L35">	private URL trackerURL = null;</span>

	/** The product properties. */
<span class="fc" id="L38">	private Map&lt;String, String&gt; properties = new HashMap&lt;String, String&gt;();</span>

	/** The product links. */
<span class="fc" id="L41">	private Map&lt;String, List&lt;URI&gt;&gt; links = new HashMap&lt;String, List&lt;URI&gt;&gt;();</span>

	/** Unique identifier for this event. */
<span class="fc" id="L44">	private String eventSource = null;</span>

	/** Unique identifier from the event network. */
<span class="fc" id="L47">	private String eventSourceCode = null;</span>

	/** When the event occurred. */
<span class="fc" id="L50">	private Date eventTime = null;</span>

	/** Where the event occurred. */
<span class="fc" id="L53">	private BigDecimal eventLatitude = null;</span>

	/** Where the event occurred. */
<span class="fc" id="L56">	private BigDecimal eventLongitude = null;</span>

	/** Where the event occurred. */
<span class="fc" id="L59">	private BigDecimal eventDepth = null;</span>

	/** How big the event was. */
<span class="fc" id="L62">	private BigDecimal eventMagnitude = null;</span>

	/** Product version. */
<span class="fc" id="L65">	private String version = null;</span>

	/** Whether this product is &quot;preferred&quot;. */
<span class="fc" id="L68">	private long preferredWeight = 0;</span>

	/**
	 * Empty constructor.
	 */
<span class="fc" id="L73">	public ProductSummary() {</span>
<span class="fc" id="L74">	}</span>

	/**
	 * Copy constructor for ProductSummary.
	 * 
	 * Does a deep copy of properties and links maps. All other attributes are
	 * copied by reference.
	 * 
	 * @param copy
	 *            product summary to copy.
	 */
<span class="fc" id="L85">	public ProductSummary(final ProductSummary copy) {</span>
<span class="fc" id="L86">		this.indexId = copy.getIndexId();</span>
<span class="fc" id="L87">		this.id = copy.getId();</span>
<span class="fc" id="L88">		this.status = copy.getStatus();</span>
<span class="fc" id="L89">		this.trackerURL = copy.getTrackerURL();</span>
<span class="fc" id="L90">		this.properties.putAll(copy.getProperties());</span>

<span class="fc" id="L92">		Map&lt;String, List&lt;URI&gt;&gt; copyLinks = copy.getLinks();</span>
<span class="fc" id="L93">		Iterator&lt;String&gt; iter = copyLinks.keySet().iterator();</span>
<span class="fc bfc" id="L94" title="All 2 branches covered.">		while (iter.hasNext()) {</span>
<span class="fc" id="L95">			String relation = iter.next();</span>
<span class="fc" id="L96">			links.put(relation, new LinkedList&lt;URI&gt;(copyLinks.get(relation)));</span>
<span class="fc" id="L97">		}</span>

<span class="fc" id="L99">		this.setEventSource(copy.getEventSource());</span>
<span class="fc" id="L100">		this.setEventSourceCode(copy.getEventSourceCode());</span>
<span class="fc" id="L101">		this.setEventTime(copy.getEventTime());</span>
<span class="fc" id="L102">		this.setEventLatitude(copy.getEventLatitude());</span>
<span class="fc" id="L103">		this.setEventLongitude(copy.getEventLongitude());</span>
<span class="fc" id="L104">		this.setEventDepth(copy.getEventDepth());</span>
<span class="fc" id="L105">		this.setEventMagnitude(copy.getEventMagnitude());</span>
<span class="fc" id="L106">		this.setVersion(copy.getVersion());</span>
<span class="fc" id="L107">		this.setPreferredWeight(copy.getPreferredWeight());</span>
<span class="fc" id="L108">	}</span>

	/**
	 * Create a ProductSummary from a product.
	 * 
	 * All attributes are copied from the product, and preferredWeight is set to
	 * 1L.
	 * 
	 * @param product
	 *            the product to summarize.
	 */
<span class="fc" id="L119">	public ProductSummary(final Product product) {</span>
<span class="fc" id="L120">		this.id = product.getId();</span>
<span class="fc" id="L121">		this.status = product.getStatus();</span>
<span class="fc" id="L122">		this.trackerURL = product.getTrackerURL();</span>
<span class="fc" id="L123">		this.properties.putAll(product.getProperties());</span>

<span class="fc" id="L125">		Map&lt;String, List&lt;URI&gt;&gt; copyLinks = product.getLinks();</span>
<span class="fc" id="L126">		Iterator&lt;String&gt; iter = copyLinks.keySet().iterator();</span>
<span class="fc bfc" id="L127" title="All 2 branches covered.">		while (iter.hasNext()) {</span>
<span class="fc" id="L128">			String relation = iter.next();</span>
<span class="fc" id="L129">			links.put(relation, new LinkedList&lt;URI&gt;(copyLinks.get(relation)));</span>
<span class="fc" id="L130">		}</span>

<span class="fc" id="L132">		this.setEventSource(product.getEventSource());</span>
<span class="fc" id="L133">		this.setEventSourceCode(product.getEventSourceCode());</span>
<span class="fc" id="L134">		this.setEventTime(product.getEventTime());</span>
<span class="fc" id="L135">		this.setEventLatitude(product.getLatitude());</span>
<span class="fc" id="L136">		this.setEventLongitude(product.getLongitude());</span>
<span class="fc" id="L137">		this.setEventDepth(product.getDepth());</span>
<span class="fc" id="L138">		this.setEventMagnitude(product.getMagnitude());</span>
<span class="fc" id="L139">		this.setVersion(product.getVersion());</span>
<span class="fc" id="L140">		this.setPreferredWeight(1L);</span>
<span class="fc" id="L141">	}</span>

	public Long getIndexId() {
<span class="fc" id="L144">		return indexId;</span>
	}

	public void setIndexId(Long indexId) {
<span class="fc" id="L148">		this.indexId = indexId;</span>
<span class="fc" id="L149">	}</span>

	public ProductId getId() {
<span class="fc" id="L152">		return id;</span>
	}

	public void setId(ProductId id) {
<span class="fc" id="L156">		this.id = id;</span>
<span class="fc" id="L157">	}</span>

	public String getStatus() {
<span class="fc" id="L160">		return status;</span>
	}

	public void setStatus(String status) {
<span class="fc" id="L164">		this.status = status;</span>
<span class="fc" id="L165">	}</span>

	public boolean isDeleted() {
<span class="fc bfc" id="L168" title="All 2 branches covered.">		if (Product.STATUS_DELETE.equalsIgnoreCase(this.status)) {</span>
<span class="fc" id="L169">			return true;</span>
		} else {
<span class="fc" id="L171">			return false;</span>
		}
	}

	public URL getTrackerURL() {
<span class="fc" id="L176">		return trackerURL;</span>
	}

	public void setTrackerURL(URL trackerURL) {
<span class="fc" id="L180">		this.trackerURL = trackerURL;</span>
<span class="fc" id="L181">	}</span>

	public long getPreferredWeight() {
<span class="fc" id="L184">		return preferredWeight;</span>
	}

	public void setPreferredWeight(long weight) {
<span class="fc" id="L188">		this.preferredWeight = weight;</span>
<span class="fc" id="L189">	}</span>

	/**
	 * @return the properties
	 */
	public Map&lt;String, String&gt; getProperties() {
<span class="fc" id="L195">		return properties;</span>
	}

	/**
	 * @param properties
	 *            the properties to set
	 */
	public void setProperties(final Map&lt;String, String&gt; properties) {
<span class="fc" id="L203">		this.properties.putAll(properties);</span>
<span class="fc" id="L204">	}</span>

	/**
	 * Returns a reference to the links map.
	 * 
	 * @return the links
	 */
	public Map&lt;String, List&lt;URI&gt;&gt; getLinks() {
<span class="fc" id="L212">		return links;</span>
	}

	/**
	 * Copies entries from provided map.
	 * 
	 * @param links
	 *            the links to set
	 */
	public void setLinks(final Map&lt;String, List&lt;URI&gt;&gt; links) {
<span class="fc" id="L222">		this.links.clear();</span>
<span class="fc" id="L223">		this.links.putAll(links);</span>
<span class="fc" id="L224">	}</span>

	/**
	 * Add a link to a product.
	 * 
	 * @param relation
	 *            how link is related to product.
	 * @param href
	 *            actual link.
	 */
	public void addLink(final String relation, final URI href) {
<span class="fc" id="L235">		List&lt;URI&gt; relationLinks = links.get(relation);</span>
<span class="pc bpc" id="L236" title="1 of 2 branches missed.">		if (relationLinks == null) {</span>
<span class="fc" id="L237">			relationLinks = new LinkedList&lt;URI&gt;();</span>
<span class="fc" id="L238">			links.put(relation, relationLinks);</span>
		}
<span class="fc" id="L240">		relationLinks.add(href);</span>
<span class="fc" id="L241">	}</span>

	public String getEventId() {
<span class="pc bpc" id="L244" title="1 of 4 branches missed.">		if (eventSource == null || eventSourceCode == null) {</span>
			// TODO: fallback on product source + product code?
<span class="fc" id="L246">			return null;</span>
		}
<span class="fc" id="L248">		return (eventSource + eventSourceCode).toLowerCase();</span>
	}

	public String getEventSource() {
<span class="fc" id="L252">		return eventSource;</span>
	}

	public void setEventSource(String eventSource) {
<span class="fc" id="L256">		this.eventSource = eventSource;</span>

		// event ids are case insensitive, force lower.
<span class="fc bfc" id="L259" title="All 2 branches covered.">		if (this.eventSource != null) {</span>
<span class="fc" id="L260">			this.eventSource = this.eventSource.toLowerCase();</span>
		}

<span class="fc bfc" id="L263" title="All 2 branches covered.">		if (this.eventSource != null) {</span>
<span class="fc" id="L264">			this.properties.put(Product.EVENTSOURCE_PROPERTY, this.eventSource);</span>
		} else {
<span class="fc" id="L266">			this.properties.remove(Product.EVENTSOURCE_PROPERTY);</span>
		}
<span class="fc" id="L268">	}</span>

	public String getEventSourceCode() {
<span class="fc" id="L271">		return eventSourceCode;</span>
	}

	public void setEventSourceCode(String eventSourceCode) {
<span class="fc" id="L275">		this.eventSourceCode = eventSourceCode;</span>

		// event ids are case insensitive, force lower.
<span class="fc bfc" id="L278" title="All 2 branches covered.">		if (this.eventSourceCode != null) {</span>
<span class="fc" id="L279">			this.eventSourceCode = this.eventSourceCode.toLowerCase();</span>
		}

<span class="fc bfc" id="L282" title="All 2 branches covered.">		if (this.eventSourceCode != null) {</span>
<span class="fc" id="L283">			this.properties.put(Product.EVENTSOURCECODE_PROPERTY,</span>
					this.eventSourceCode);
		} else {
<span class="fc" id="L286">			this.properties.remove(Product.EVENTSOURCECODE_PROPERTY);</span>
		}
<span class="fc" id="L288">	}</span>

	public Date getEventTime() {
<span class="fc" id="L291">		return eventTime;</span>
	}

	public void setEventTime(Date eventTime) {
<span class="fc" id="L295">		this.eventTime = eventTime;</span>
<span class="fc bfc" id="L296" title="All 2 branches covered.">		if (eventTime != null) {</span>
<span class="fc" id="L297">			this.properties.put(Product.EVENTTIME_PROPERTY,</span>
<span class="fc" id="L298">					XmlUtils.formatDate(eventTime));</span>
		} else {
<span class="fc" id="L300">			this.properties.remove(Product.EVENTTIME_PROPERTY);</span>
		}

<span class="fc" id="L303">	}</span>

	public BigDecimal getEventLatitude() {
<span class="fc" id="L306">		return eventLatitude;</span>
	}

	public void setEventLatitude(BigDecimal eventLatitude) {
<span class="fc" id="L310">		this.eventLatitude = eventLatitude;</span>
<span class="fc bfc" id="L311" title="All 2 branches covered.">		if (eventLatitude != null) {</span>
<span class="fc" id="L312">			this.properties.put(Product.LATITUDE_PROPERTY,</span>
<span class="fc" id="L313">					eventLatitude.toString());</span>
		} else {
<span class="fc" id="L315">			this.properties.remove(Product.LATITUDE_PROPERTY);</span>
		}
<span class="fc" id="L317">	}</span>

	public BigDecimal getEventLongitude() {
<span class="fc" id="L320">		return eventLongitude;</span>
	}

	public void setEventLongitude(BigDecimal eventLongitude) {
<span class="fc" id="L324">		this.eventLongitude = eventLongitude;</span>
<span class="fc bfc" id="L325" title="All 2 branches covered.">		if (eventLongitude != null) {</span>
<span class="fc" id="L326">			this.properties.put(Product.LONGITUDE_PROPERTY,</span>
<span class="fc" id="L327">					eventLongitude.toString());</span>
		} else {
<span class="fc" id="L329">			this.properties.remove(Product.LONGITUDE_PROPERTY);</span>
		}
<span class="fc" id="L331">	}</span>

	public BigDecimal getEventDepth() {
<span class="fc" id="L334">		return eventDepth;</span>
	}

	public void setEventDepth(BigDecimal eventDepth) {
<span class="fc" id="L338">		this.eventDepth = eventDepth;</span>
<span class="fc bfc" id="L339" title="All 2 branches covered.">		if (eventDepth != null) {</span>
<span class="fc" id="L340">			this.properties.put(Product.DEPTH_PROPERTY, eventDepth.toString());</span>
		} else {
<span class="fc" id="L342">			this.properties.remove(Product.DEPTH_PROPERTY);</span>
		}
<span class="fc" id="L344">	}</span>

	public BigDecimal getEventMagnitude() {
<span class="fc" id="L347">		return eventMagnitude;</span>
	}

	public void setEventMagnitude(BigDecimal eventMagnitude) {
<span class="fc" id="L351">		this.eventMagnitude = eventMagnitude;</span>
<span class="fc bfc" id="L352" title="All 2 branches covered.">		if (eventMagnitude != null) {</span>
<span class="fc" id="L353">			this.properties.put(Product.MAGNITUDE_PROPERTY,</span>
<span class="fc" id="L354">					eventMagnitude.toString());</span>
		} else {
<span class="fc" id="L356">			this.properties.remove(Product.MAGNITUDE_PROPERTY);</span>
		}
<span class="fc" id="L358">	}</span>

	public String getVersion() {
<span class="fc" id="L361">		return version;</span>
	}

	public void setVersion(String version) {
<span class="fc" id="L365">		this.version = version;</span>
<span class="fc bfc" id="L366" title="All 2 branches covered.">		if (version != null) {</span>
<span class="fc" id="L367">			this.properties.put(Product.VERSION_PROPERTY, version);</span>
		} else {
<span class="fc" id="L369">			this.properties.remove(Product.VERSION_PROPERTY);</span>
		}
<span class="fc" id="L371">	}</span>

	public String getType() {
<span class="fc" id="L374">		return getId().getType();</span>
	}

	public String getSource() {
<span class="fc" id="L378">		return getId().getSource();</span>
	}

	public String getCode() {
<span class="fc" id="L382">		return getId().getCode();</span>
	}

	public Date getUpdateTime() {
<span class="fc" id="L386">		return getId().getUpdateTime();</span>
	}

	/**
	 * Compares two ProductSummaries to determine if they are equal.
	 * 
	 * This first implementation just considers the ProductId of each summary.
	 * This is probably not the best way to check for equality. TODO: Implement
	 * a more robust method of comparison
	 */
	@Override
	public boolean equals(Object o) {
<span class="pc bpc" id="L398" title="1 of 2 branches missed.">		if (o instanceof ProductSummary) {</span>
<span class="fc" id="L399">			return ((ProductSummary) o).getId().equals(this.getId());</span>
		}
<span class="nc" id="L401">		return false;</span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.1.201803210924</span></div></body></html>